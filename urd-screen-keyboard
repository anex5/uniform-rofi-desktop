#!/usr/bin/env sh
#
# Rofi powered menu to prompt a password.
# Uses: rofi
ORIGIN="$(readlink -q "${BASH_SOURCE[0]}" || echo -e "${BASH_SOURCE[0]}" )"
cd "${ORIGIN%/*}"
source "./common/definitions"
prog="${0##*/}"
args=$*
nprog="${prog//-/_}"
usage="${texts[usage]}: ${prog} [${texts[options]}]

    ${texts[usage_${nprog##*urd_}]^}
    ${common_usage}
"
# parse options
handle_common_opts "$@"

rofiargs="${rofiargs// -keep-filter} -keep-filter"
header="${texts[header_screen-keyboard]:-Screen keyboard}"
keys="./common/keyboards/QUERTY_en-US_40.keys"
theme="./common/themes/horizontal_keyboard.rasi"

entries="$(<${keys})"

handle_rofi

#send_notification "After handle rofi. RETV=${ROFI_RETV}"
if ${force_dmenu} ; then
	  case ${ROFI_RETV} in
				0) # Restart after selection
						exec ./${prog} ${args// -arg *} -arg "-f ${chosen}"
				;;
	  esac
else
		case ${ROFI_RETV} in
				10) # set 
						wtype "${args}" && send_notification "${texts[copied]^}: ${args}" || die
				;;
				0) # Restart after selection
						keepselection=true
						write_script_entries
				;;
		esac
fi
